<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ambience.io</title>
    
    <script src="https://cdn.tailwindcss.com"></script>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 8px;
            cursor: pointer;
            border-radius: 99px;
            background: #e2e8f0; 
        }
        
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, #8b5cf6, #6d28d9);
            margin-top: -6px;
            box-shadow: 0 4px 10px rgba(109, 40, 217, 0.3);
            transition: all 0.2s ease-in-out;
        }

        input[type=range]:hover::-webkit-slider-thumb {
            transform: scale(1.1);
            box-shadow: 0 6px 15px rgba(109, 40, 217, 0.4);
        }
    </style>
    
    <script>
        tailwind.config = {
          theme: {
            extend: {
              colors: {
                primary: { DEFAULT: '#8b5cf6', light: '#ddd6fe', dark: '#6d28d9' }, 
              }
            }
          }
        }
      </script>
</head>
<body class="antialiased">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const Icons = {
            Rain: () => <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"/><path d="M16 14v6"/><path d="M8 14v6"/><path d="M12 16v6"/></svg>,
            Wind: () => <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"/><path d="M9.6 4.6A2 2 0 1 1 11 8H2"/><path d="M12.6 19.4A2 2 0 1 0 14 16H2"/></svg>,
            Forest: () => <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><path d="M12 10a6 6 0 0 0-6 6h12a6 6 0 0 0-6-6Z"/><path d="M7 6a6.5 6.5 0 1 0 0 13h10a6.5 6.5 0 0 0 0-13"/></svg>,
            Coffee: () => <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><path d="M17 8h1a4 4 0 1 1 0 8h-1"/><path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"/><line x1="6" x2="6" y1="2" y2="4"/><line x1="10" x2="10" y1="2" y2="4"/><line x1="14" x2="14" y1="2" y2="4"/></svg>,
            WhiteNoise: () => <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><path d="M2 12h20"/><path d="M3 9h18"/><path d="M4 15h16"/><path d="M5 6h14"/><path d="M6 18h12"/></svg>,
            Birds: () => <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><path d="M16 7h.01"/><path d="M3.4 18H12a8 8 0 0 0 8-8V7a4 4 0 0 0-7.28-2.3L2 20"/><path d="m20 7 2 .5-2 .5"/><path d="M10 18v3"/><path d="M14 17.75V21"/><path d="M7 18a6 6 0 0 0 3.84-10.61"/></svg>,
            Play: () => <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="currentColor" stroke="none"><polygon points="5 3 19 12 5 21 5 3"/></svg>,
            Pause: () => <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="currentColor" stroke="none"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>,
            Power: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18.36 6.64a9 9 0 1 1-12.73 0"/><line x1="12" x2="12" y1="2" y2="12"/></svg>
        };

        const SOUNDS_DATA = [
            { id: 'rain', label: 'Chuva Forte', icon: Icons.Rain, src: './sons/chuva.mp3' },
            { id: 'wind', label: 'Vento e Trovão', icon: Icons.Wind, src: './sons/vento.mp3' },
            { id: 'forest', label: 'Floresta Viva', icon: Icons.Forest, src: './sons/floresta.mp3' },
            { id: 'coffee', label: 'Cafeteria', icon: Icons.Coffee, src: './sons/cafeteria.mp3' },
            { id: 'white', label: 'Ruído Suave', icon: Icons.WhiteNoise, src: './sons/ruido.mp3' },
            { id: 'birds', label: 'Pássaros Manhã', icon: Icons.Birds, src: './sons/passaros.mp3' },
        ];

        const PRESETS = [
            { name: 'Foco Profundo', active: ['rain', 'white'], volumes: { rain: 0.6, white: 0.4 } },
            { name: 'Dormir Bem', active: ['rain', 'wind'], volumes: { rain: 0.8, wind: 0.3 } },
            { name: 'Relaxar', active: ['forest', 'birds'], volumes: { forest: 0.5, birds: 0.7 } },
        ];

        const glassCardClass = "bg-white/60 backdrop-blur-xl border border-white/50 shadow-xl shadow-violet-200/20 rounded-3xl";

        const AmbientMixer = () => {
            const [isPlaying, setIsPlaying] = useState(false);
            const [activeSounds, setActiveSounds] = useState({});
            const [volumes, setVolumes] = useState({});
            const [masterVolume, setMasterVolume] = useState(0.8);
            const [timerMinutes, setTimerMinutes] = useState(0);
            const [timeLeft, setTimeLeft] = useState(null);
            
            const audioContextRef = useRef(null);
            const masterGainRef = useRef(null);
            const tracksRef = useRef({});

            useEffect(() => {
                const initialVolumes = {};
                const initialActive = {};
                SOUNDS_DATA.forEach(sound => {
                    initialVolumes[sound.id] = 0.5;
                    initialActive[sound.id] = false;
                });
                setVolumes(initialVolumes);
                setActiveSounds(initialActive);
                
                return () => { if (audioContextRef.current) audioContextRef.current.close(); };
            }, []);

            useEffect(() => {
                let interval = null;
                if (timeLeft > 0 && isPlaying) {
                    interval = setInterval(() => { setTimeLeft((prev) => prev - 1); }, 1000);
                } else if (timeLeft === 0) {
                    setIsPlaying(false);
                    setTimeLeft(null);
                    setTimerMinutes(0);
                    const newActive = { ...activeSounds };
                    Object.keys(newActive).forEach(key => newActive[key] = false);
                    setActiveSounds(newActive);
                    Object.keys(tracksRef.current).forEach(id => { tracksRef.current[id].audio.pause(); });
                }
                return () => clearInterval(interval);
            }, [timeLeft, isPlaying]);

            const startTimer = (minutes) => { setTimerMinutes(minutes); setTimeLeft(minutes * 60); };

            const initAudio = () => {
                if (!audioContextRef.current) {
                    const AudioContext = window.AudioContext || window.webkitAudioContext;
                    const ctx = new AudioContext();
                    audioContextRef.current = ctx;

                    const masterGain = ctx.createGain();
                    masterGain.gain.value = masterVolume;
                    masterGain.connect(ctx.destination);
                    masterGainRef.current = masterGain;

                    SOUNDS_DATA.forEach(sound => {
                        const audio = new Audio(sound.src);
                        audio.crossOrigin = "anonymous";
                        audio.loop = true;

                        audio.onerror = (e) => {
                            console.error(`Erro ao carregar: ${sound.src}`);
                            alert(`ERRO: Não encontrei o arquivo "${sound.src}".\nVerifique se o nome do arquivo na pasta 'sons' está igual.`);
                        };

                        const source = ctx.createMediaElementSource(audio);
                        const gainNode = ctx.createGain();
                        
                        gainNode.gain.value = 0;
                        source.connect(gainNode);
                        gainNode.connect(masterGain);

                        tracksRef.current[sound.id] = { audio, gainNode };
                    });
                }
                
                if (audioContextRef.current.state === 'suspended') {
                    audioContextRef.current.resume();
                }
            };

            const togglePlayMaster = () => {
                initAudio();
                const newState = !isPlaying;
                setIsPlaying(newState);

                Object.keys(tracksRef.current).forEach(id => {
                    const { audio } = tracksRef.current[id];
                    if (newState && activeSounds[id]) {
                        audio.play().catch(e => console.error("Erro no play:", e));
                    } else {
                        audio.pause();
                    }
                });
            };

            const toggleSound = (id) => {
                initAudio();
                const isActive = !activeSounds[id];
                setActiveSounds(prev => ({ ...prev, [id]: isActive }));

                const track = tracksRef.current[id];
                if (track) {
                    if (isActive) {
                        track.gainNode.gain.value = volumes[id];
                        if (isPlaying) {
                            track.audio.play().catch(e => console.error(e));
                        }
                    } else {
                        track.audio.pause();
                        track.audio.currentTime = 0;
                    }
                }
            };

            const handleVolumeChange = (id, val) => {
                const newVol = parseFloat(val);
                setVolumes(prev => ({ ...prev, [id]: newVol }));
                
                const track = tracksRef.current[id];
                if (track && activeSounds[id]) {
                    track.gainNode.gain.setTargetAtTime(newVol, audioContextRef.current.currentTime, 0.1);
                }
            };

            const handleMasterVolume = (val) => {
                const newVol = parseFloat(val);
                setMasterVolume(newVol);
                if (masterGainRef.current) {
                    masterGainRef.current.gain.setTargetAtTime(newVol, audioContextRef.current.currentTime, 0.1);
                }
            };

            const applyPreset = (preset) => {
                const newActive = {};
                const newVolumes = { ...volumes };
                SOUNDS_DATA.forEach(s => newActive[s.id] = false);

                preset.active.forEach(id => {
                    newActive[id] = true;
                    if (preset.volumes[id]) newVolumes[id] = preset.volumes[id];
                });

                setActiveSounds(newActive);
                setVolumes(newVolumes);

                initAudio();
                Object.keys(tracksRef.current).forEach(id => {
                    const track = tracksRef.current[id];
                    const shouldPlay = newActive[id];
                    if (shouldPlay) {
                        track.gainNode.gain.value = newVolumes[id];
                        if (isPlaying) track.audio.play();
                    } else {
                        track.audio.pause();
                    }
                });

                if (!isPlaying) togglePlayMaster();
            };

            return (
                <div className="min-h-screen bg-[radial-gradient(ellipse_at_top_left,_var(--tw-gradient-stops))] from-violet-100 via-slate-50 to-cyan-100 text-slate-700 font-sans p-6 md:p-12 flex flex-col items-center selection:bg-violet-200">
                    <header className="mb-12 text-center relative z-10">
                        <h1 className="text-5xl font-bold tracking-tight text-transparent bg-clip-text bg-gradient-to-r from-violet-600 to-indigo-600 mb-3 drop-shadow-sm">Ambience.io</h1>
                        <p className="text-slate-500 text-lg font-medium">Seu refúgio sonoro pessoal.</p>
                    </header>

                    <main className="w-full max-w-5xl relative z-10">
                        <div className={`${glassCardClass} p-8 mb-10 flex flex-col md:flex-row items-center justify-between gap-8`}>
                            <button 
                                onClick={togglePlayMaster}
                                className={`flex items-center gap-4 px-10 py-5 rounded-full text-xl font-bold transition-all duration-500 transform hover:scale-105 hover:shadow-2xl ${
                                    isPlaying 
                                        ? 'bg-gradient-to-r from-rose-400 to-orange-500 text-white shadow-orange-300/50' 
                                        : 'bg-gradient-to-r from-violet-500 to-indigo-600 text-white shadow-violet-400/50'
                                }`}
                            >
                                {isPlaying ? <Icons.Pause /> : <Icons.Play />}
                                {isPlaying ? 'Pausar' : 'Iniciar Foco'}
                            </button>
                            <div className="flex items-center gap-6 w-full md:w-2/3 bg-white/40 p-4 rounded-2xl border border-white/50">
                                <span className="text-violet-700 font-bold text-sm uppercase tracking-wider">Master Volume</span>
                                <input type="range" min="0" max="1" step="0.01" value={masterVolume} onChange={(e) => handleMasterVolume(e.target.value)} className="w-full accent-violet-600" />
                            </div>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-8 mb-10">
                            <div className={`${glassCardClass} p-6 flex flex-col justify-center`}>
                                <h3 className="text-xs font-extrabold text-violet-400 uppercase tracking-widest mb-5 flex items-center gap-2">
                                    <span className="inline-block w-2 h-2 rounded-full bg-violet-400"></span> Moods Rápidos
                                </h3>
                                <div className="flex gap-3 flex-wrap">
                                    {PRESETS.map(preset => (
                                        <button key={preset.name} onClick={() => applyPreset(preset)} className="px-5 py-2.5 text-sm font-medium bg-white/50 hover:bg-violet-100 hover:text-violet-700 text-slate-600 rounded-xl border border-white/60 transition-all shadow-sm hover:shadow-md">{preset.name}</button>
                                    ))}
                                </div>
                            </div>
                            <div className={`${glassCardClass} p-6 flex flex-col justify-center`}>
                                <div className="flex justify-between items-center mb-5">
                                    <h3 className="text-xs font-extrabold text-violet-400 uppercase tracking-widest flex items-center gap-2">
                                         <span className="inline-block w-2 h-2 rounded-full bg-violet-400"></span> Sleep Timer
                                    </h3>
                                    {timeLeft > 0 && <span className="text-lg font-bold font-mono text-violet-600 bg-violet-100 px-3 py-1 rounded-lg animate-pulse">{Math.floor(timeLeft / 60)}:{(timeLeft % 60).toString().padStart(2, '0')}</span>}
                                </div>
                                <div className="flex gap-3 items-center">
                                    {[15, 30, 60].map(time => (
                                        <button key={time} onClick={() => startTimer(time)} className={`flex-1 py-3 text-sm font-bold rounded-xl border transition-all shadow-sm ${timerMinutes === time && timeLeft > 0 ? 'border-violet-500/50 text-violet-700 bg-violet-100/80 shadow-inner' : 'border-white/60 bg-white/50 text-slate-500 hover:bg-white/80 hover:text-violet-600 hover:border-violet-200'}`}>{time} min</button>
                                    ))}
                                    {timeLeft > 0 && <button onClick={() => { setTimeLeft(0); setTimerMinutes(0); }} className="p-3 text-slate-400 hover:text-rose-500 bg-white/50 rounded-xl border border-white/60 transition-colors hover:bg-rose-50"><Icons.Power /></button>}
                                </div>
                            </div>
                        </div>

                        <div className="grid grid-cols-2 md:grid-cols-3 gap-6 md:gap-8">
                            {SOUNDS_DATA.map(sound => {
                                const isActive = activeSounds[sound.id];
                                const volume = volumes[sound.id] || 0.5;
                                return (
                                    <div key={sound.id} className={`group relative p-6 rounded-3xl transition-all duration-500 border backdrop-blur-md ${isActive ? 'bg-white/90 border-violet-300/50 shadow-xl shadow-violet-200/40 scale-[1.03]' : 'bg-white/30 border-white/40 hover:bg-white/60 hover:shadow-lg hover:border-white/70'}`}>
                                        <div className="flex justify-between items-start mb-6">
                                            <div className={`p-4 rounded-2xl transition-all duration-500 ${isActive ? 'bg-gradient-to-br from-violet-100 to-indigo-100 text-violet-600 shadow-inner' : 'bg-slate-100/50 text-slate-400 group-hover:bg-white/80 group-hover:text-slate-500'}`}><sound.icon /></div>
                                            <button onClick={() => toggleSound(sound.id)} className={`w-12 h-7 rounded-full p-1 transition-colors duration-500 focus:outline-none ${isActive ? 'bg-violet-600' : 'bg-slate-300/80'}`}>
                                                <div className={`bg-white w-5 h-5 rounded-full shadow-sm transform transition-transform duration-500 ${isActive ? 'translate-x-5' : 'translate-x-0'}`} />
                                            </button>
                                        </div>
                                        <h3 className={`text-lg font-bold mb-4 transition-colors ${isActive ? 'text-slate-800' : 'text-slate-500'}`}>{sound.label}</h3>
                                        <div className={`transition-all duration-500 ${isActive ? 'opacity-100' : 'opacity-20 grayscale pointer-events-none'}`}>
                                             <input type="range" min="0" max="1" step="0.05" value={volume} disabled={!isActive} onChange={(e) => handleVolumeChange(sound.id, e.target.value)} className="w-full accent-violet-500" />
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </main>

                    {/* RODAPÉ ADICIONADO AQUI */}
                    <footer className="mt-12 py-6 text-center relative z-10">
                        <p className="text-slate-500 text-sm font-medium">
                            &copy; {new Date().getFullYear()} Ambience.io. Todos os direitos reservados.
                        </p>
                    </footer>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<AmbientMixer />);
    </script>
</body>
</html>